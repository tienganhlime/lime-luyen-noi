<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luyá»‡n PhÃ¡t Ã‚m - LIME</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.2"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 50%, #81C784 100%);
        }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4CAF50;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: inline-block;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>

<!-- Loading Spinner -->
<div id="loading" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white p-8 rounded-lg shadow-2xl">
        <div class="animate-spin h-12 w-12 border-4 border-green-500 border-t-transparent rounded-full mx-auto mb-4"></div>
        <p class="text-gray-700 font-semibold">Äang xá»­ lÃ½...</p>
    </div>
</div>

<!-- 1. TRANG CHá»¦ -->
<div id="loginScreen" class="min-h-screen flex items-center justify-center p-4 fade-in">
    <div class="bg-white rounded-2xl shadow-2xl p-10 max-w-md w-full">
        <div class="text-center mb-8">
            <img src="https://gofirst.pro/images/uploads/62/baseimg/logo_16541442053.png" alt="LIME Logo" class="w-32 h-32 mx-auto mb-6 object-contain">
            <h1 class="text-4xl font-bold text-green-600 mb-2">ğŸ™ï¸ Luyá»‡n PhÃ¡t Ã‚m</h1>
            <p class="text-green-700">Trung TÃ¢m Tiáº¿ng Anh LIME</p>
        </div>
        
        <div class="bg-green-50 border-2 border-green-200 rounded-xl p-6 mb-8">
            <h3 class="font-bold text-green-800 mb-4 text-lg">ğŸ¯ HÆ°á»›ng dáº«n nhanh:</h3>
            <div class="space-y-2 text-sm text-green-700">
                <p>â€¢ ğŸ‘¨â€ğŸ“ Há»c sinh: Nháº­p mÃ£ HS001</p>
                <p>â€¢ ğŸ‘¨â€ğŸ« GiÃ¡o viÃªn: Nháº­p mÃ£ GV001</p>
                <p>â€¢ ğŸ¤ NÃ³i theo tá»« â†’ AI cháº¥m Ä‘iá»ƒm ngay</p>
            </div>
        </div>

        <div class="space-y-4">
            <button onclick="selectRole('teacher')" 
                    class="w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white py-4 rounded-xl text-xl font-bold shadow-lg hover:shadow-xl transition-all duration-300 flex items-center justify-center gap-3">
                ğŸ‘¨â€ğŸ« TÃ´i lÃ  GiÃ¡o viÃªn
            </button>
            <button onclick="selectRole('student')" 
                    class="w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white py-4 rounded-xl text-xl font-bold shadow-lg hover:shadow-xl transition-all duration-300 flex items-center justify-center gap-3">
                ğŸ‘¨â€ğŸ“ TÃ´i lÃ  Há»c sinh
            </button>
        </div>
        
        <div class="mt-6 p-4 bg-blue-50 border-2 border-blue-200 rounded-xl">
            <button onclick="startDemo()" 
                    class="w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white py-3 rounded-xl font-bold hover:shadow-lg transition-all flex items-center justify-center gap-2">
                ğŸš€ THá»¬ NGAY (Demo - KhÃ´ng cáº§n Ä‘Äƒng nháº­p)
            </button>
        </div>
    </div>
</div>

<!-- 2. LOGIN GIÃO VIÃŠN -->
<div id="teacherLoginScreen" class="screen hidden min-h-screen flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full">
        <button onclick="showScreen('loginScreen')" class="text-green-600 mb-6 font-semibold flex items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
            </svg>
            Quay láº¡i
        </button>
        <h2 class="text-3xl font-bold text-green-600 text-center mb-6">ğŸ‘¨â€ğŸ« ÄÄƒng nháº­p GiÃ¡o viÃªn</h2>
        <input type="text" id="teacherCode" placeholder="Nháº­p mÃ£ giÃ¡o viÃªn (VD: GV001)" 
               class="w-full p-4 border-2 border-green-200 rounded-xl focus:border-green-500 focus:outline-none text-lg mb-6" value="GV001">
        <button onclick="loginTeacher()" 
                class="w-full bg-gradient-to-r from-green-500 to-green-600 text-white py-4 rounded-xl font-bold text-lg shadow-lg hover:shadow-xl transition-all">
            ğŸš€ VÃ o Dashboard
        </button>
    </div>
</div>

<!-- 3. LOGIN Há»ŒC SINH -->
<div id="studentLoginScreen" class="screen hidden min-h-screen flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full">
        <button onclick="showScreen('loginScreen')" class="text-green-600 mb-6 font-semibold flex items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
            </svg>
            Quay láº¡i
        </button>
        <h2 class="text-3xl font-bold text-green-600 text-center mb-6">ğŸ‘¨â€ğŸ“ ÄÄƒng nháº­p Há»c sinh</h2>
        <input type="text" id="studentCode" placeholder="Nháº­p mÃ£ há»c sinh (VD: HS001)" 
               class="w-full p-4 border-2 border-green-200 rounded-xl focus:border-green-500 focus:outline-none text-lg mb-6" value="HS001">
        <button onclick="loginStudent()" 
                class="w-full bg-gradient-to-r from-green-500 to-green-600 text-white py-4 rounded-xl font-bold text-lg shadow-lg hover:shadow-xl transition-all">
            ğŸš€ Báº¯t Ä‘áº§u luyá»‡n táº­p
        </button>
    </div>
</div>

<!-- 4. DASHBOARD Há»ŒC SINH -->
<div id="studentDashboard" class="screen hidden min-h-screen p-6 bg-gradient-to-br from-emerald-50 to-blue-50">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="bg-white rounded-2xl shadow-2xl p-8 mb-8">
            <div class="flex flex-wrap justify-between items-center gap-6">
                <div class="flex items-center gap-4">
                    <img src="https://gofirst.pro/images/uploads/62/baseimg/logo_16541442053.png" alt="LIME Logo" class="w-16 h-16">
                    <div>
                        <h1 class="text-4xl font-bold text-green-600">ğŸ‘¨â€ğŸ“ BÃ i táº­p hÃ´m nay</h1>
                        <p class="text-green-700 font-semibold">Há»c sinh: <span id="studentNameDisplay"></span></p>
                    </div>
                </div>
                <button onclick="logout()" class="bg-red-500 hover:bg-red-600 text-white px-8 py-3 rounded-xl font-bold shadow-lg hover:shadow-xl transition-all">
                    ğŸšª ThoÃ¡t
                </button>
            </div>
        </div>

        <!-- Assignments -->
        <div id="studentAssignments" class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
            <!-- BÃ i táº­p sáº½ load á»Ÿ Ä‘Ã¢y -->
        </div>
    </div>
</div>

<!-- 5. MÃ€N HÃŒNH LUYá»†N Táº¬P -->
<div id="practiceScreen" class="screen hidden min-h-screen p-6 bg-gradient-to-br from-emerald-50 via-green-50 to-blue-50">
    <div class="max-w-7xl mx-auto">
        <div class="bg-white rounded-2xl shadow-2xl p-8 mb-8">
            <div class="flex flex-wrap gap-6 items-center justify-between">
                <div class="flex items-center gap-6 flex-wrap">
                    <button onclick="backToStudent()" class="inline-flex items-center gap-2 text-green-600 hover:text-green-700 font-semibold text-lg bg-green-50 px-4 py-2 rounded-xl">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                        </svg>
                        Quay láº¡i
                    </button>
                    <div>
                        <h2 id="assignmentTitle" class="text-4xl font-bold text-gray-800"></h2>
                        <p class="text-2xl font-semibold text-green-600 mt-2">Luyá»‡n phÃ¡t Ã¢m tá»« vá»±ng</p>
                    </div>
                </div>
                <div class="flex flex-wrap gap-8 text-lg font-semibold text-gray-700">
                    <span class="bg-green-50 px-4 py-2 rounded-xl">ğŸ“Š <span id="progressText">0/10</span></span>
                    <span class="bg-blue-50 px-4 py-2 rounded-xl">â­ <span id="avgScoreText">0</span> Ä‘iá»ƒm</span>
                </div>
            </div>
        </div>
        
        <div id="wordsList" class="grid md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
            <!-- Tá»« vá»±ng sáº½ render á»Ÿ Ä‘Ã¢y -->
        </div>
    </div>
</div>

<script>
// ==================== GLOBAL VARIABLES ====================
let currentUser = null;
let currentAssignment = null;
let whisperPipeline = null;
let assignments = [];

// ==================== UTILITY FUNCTIONS ====================
function showScreen(screenId) {
    document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden'));
    document.getElementById(screenId).classList.remove('hidden');
}

function showLoading(show) {
    document.getElementById('loading').classList.toggle('hidden', !show);
}

// ==================== LOGIN FUNCTIONS ====================
window.selectRole = function(role) {
    currentUser = { role };
    showScreen(role === 'teacher' ? 'teacherLoginScreen' : 'studentLoginScreen');
}

window.loginTeacher = function() {
    const code = document.getElementById('teacherCode').value.trim();
    if (!code) {
        alert('Vui lÃ²ng nháº­p mÃ£ giÃ¡o viÃªn!');
        return;
    }
    
    currentUser = { role: 'teacher', code, name: `GV ${code}` };
    document.getElementById('teacherCodeDisplay').textContent = code;
    showScreen('teacherDashboard');
    alert(`ğŸ‰ ÄÄƒng nháº­p thÃ nh cÃ´ng!\nMÃ£ GV: ${code}`);
}

window.loginStudent = function() {
    const code = document.getElementById('studentCode').value.trim();
    if (!code) {
        alert('Vui lÃ²ng nháº­p mÃ£ há»c sinh!');
        return;
    }
    
    currentUser = { role: 'student', code, name: `Há»c sinh ${code}` };
    document.getElementById('studentNameDisplay').textContent = currentUser.name;
    
    // Táº¡o bÃ i táº­p demo
    assignments = [{
        id: 'nutrition',
        title: 'ğŸ Dinh dÆ°á»¡ng há»c Ä‘Æ°á»ng',
        words: ['protein', 'vitamin', 'carbohydrate', 'fibre', 'diet']
    }];
    
    renderStudentAssignments();
    showScreen('studentDashboard');
    alert(`ğŸ‰ ChÃ o ${currentUser.name}!\nSáºµn sÃ ng luyá»‡n phÃ¡t Ã¢m!`);
}

window.logout = function() {
    currentUser = null;
    currentAssignment = null;
    showScreen('loginScreen');
}

// ==================== STUDENT DASHBOARD ====================
function renderStudentAssignments() {
    const container = document.getElementById('studentAssignments');
    let html = '';
    
    assignments.forEach(assignment => {
        html += `
            <div class="bg-white rounded-2xl shadow-xl p-8 text-center border-2 border-gray-200 hover:border-green-400 hover:shadow-2xl transition-all duration-300 cursor-pointer" onclick="startAssignment('${assignment.id}')">
                <div class="w-20 h-20 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full mx-auto mb-6 flex items-center justify-center">
                    <span class="text-3xl text-white">ğŸ“š</span>
                </div>
                <h3 class="text-2xl font-bold text-gray-800 mb-4">${assignment.title}</h3>
                <p class="text-green-600 font-semibold">${assignment.words.length} tá»« vá»±ng</p>
                <p class="text-sm text-gray-500 mt-2">Nháº¥n Ä‘á»ƒ báº¯t Ä‘áº§u luyá»‡n táº­p</p>
            </div>
        `;
    });
    
    container.innerHTML = html || `
        <div class="col-span-full bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-2xl p-12 text-center">
            <div class="mx-auto w-24 h-24 bg-blue-100 rounded-full flex items-center justify-center mb-6">
                <span class="text-4xl">ğŸ“š</span>
            </div>
            <h3 class="text-2xl font-bold text-blue-700 mb-4">ChÆ°a cÃ³ bÃ i táº­p</h3>
            <p class="text-blue-600 mb-6">LiÃªn há»‡ giÃ¡o viÃªn Ä‘á»ƒ Ä‘Æ°á»£c giao bÃ i</p>
            <button onclick="startDemo()" class="bg-gradient-to-r from-blue-500 to-indigo-500 text-white px-8 py-3 rounded-xl font-bold hover:shadow-xl transition-all">
                ğŸš€ Thá»­ Demo
            </button>
        </div>
    `;
}

window.startAssignment = function(assignmentId) {
    const assignment = assignments.find(a => a.id === assignmentId);
    if (!assignment) return;
    
    currentAssignment = {
        id: assignment.id,
        name: assignment.title,
        wordsData: assignment.words.map(word => ({ word, attempts: 0, bestScore: 0 }))
    };
    
    document.getElementById('assignmentTitle').textContent = currentAssignment.name;
    renderWordsList();
    showScreen('practiceScreen');
}

window.backToStudent = function() {
    renderStudentAssignments();
    showScreen('studentDashboard');
}

// ==================== SYLLABLE ANALYSIS ====================
const syllableDB = {
    'protein': ['pro', 'tein'],
    'vitamin': ['vi', 'ta', 'min'],
    'carbohydrate': ['car', 'bo', 'hy', 'drate'],
    'fibre': ['fi', 'bre'],
    'diet': ['di', 'et'],
    'exercise': ['ex', 'er', 'cise'],
    'healthy': ['heal', 'thy']
};

function splitIntoSyllables(word) {
    const original = word;
    word = word.toLowerCase().trim();
    
    if (syllableDB[word]) return syllableDB[word];
    
    if (word.length <= 3) return [word];
    
    const vowels = 'aeiouy';
    const syllables = [];
    let start = 0;
    
    for (let i = 1; i < word.length; i++) {
        const prevIsVowel = vowels.includes(word[i - 1]);
        const currIsVowel = vowels.includes(word[i]);
        
        if (prevIsVowel && !currIsVowel && i < word.length - 1) {
            syllables.push(word.substring(start, i));
            start = i;
        }
    }
    
    if (start < word.length) {
        syllables.push(word.substring(start));
    }
    
    return syllables.length > 0 ? syllables : [word];
}

function similarity(s1, s2) {
    if (!s1 || !s2) return 0;
    s1 = s1.toLowerCase();
    s2 = s2.toLowerCase();
    let longer = s1.length > s2.length ? s1 : s2;
    let shorter = s1.length > s2.length ? s2 : s1;
    if (longer.length === 0) return 1.0;
    let distance = 0;
    for (let i = 0; i < shorter.length; i++) {
        if (longer[i] !== shorter[i]) distance++;
    }
    return (longer.length - distance) / longer.length;
}

function calculateScore(correctWord, spokenWord) {
    correctWord = correctWord.toLowerCase().trim();
    spokenWord = spokenWord.toLowerCase().trim();
    
    // Exact match
    if (spokenWord === correctWord) return 100;
    
    // Similarity score
    const sim = similarity(correctWord, spokenWord);
    
    // Length penalty
    const lengthDiff = Math.abs(correctWord.length - spokenWord.length);
    let score = Math.round(sim * 90);
    if (lengthDiff > 2) score -= lengthDiff * 5;
    
    return Math.max(0, Math.min(100, score));
}

// ==================== SPEECH FUNCTIONS ====================
window.speakWord = function(word, rate = 1) {
    if ('speechSynthesis' in window) {
        const utterance = new SpeechSynthesisUtterance(word);
        utterance.rate = rate;
        utterance.lang = 'en-US';
        utterance.volume = 1;
        utterance.pitch = 1;
        speechSynthesis.speak(utterance);
    }
}

// ==================== MAIN RECORD FUNCTION ====================
window.recordWord = async function(word) {
    const resultDiv = document.getElementById(`result-${word}`);
    
    // Simple fallback - Web Speech API
    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
        resultDiv.innerHTML = `
            <div class="p-6 bg-gray-50 border-2 border-gray-200 rounded-xl text-center">
                <p class="text-gray-700 font-bold">ğŸ¤ TrÃ¬nh duyá»‡t khÃ´ng há»— trá»£ nháº­n diá»‡n giá»ng nÃ³i</p>
                <p class="text-sm text-gray-500 mt-2">Vui lÃ²ng dÃ¹ng Chrome/Edge Ä‘á»ƒ cÃ³ tráº£i nghiá»‡m tá»‘t nháº¥t</p>
            </div>
        `;
        return;
    }

    // Recording UI
    resultDiv.innerHTML = `
        <div class="p-8 bg-gradient-to-r from-red-50 to-pink-50 border-2 border-red-200 rounded-2xl text-center animate-pulse">
            <div class="inline-block w-20 h-20 bg-gradient-to-br from-red-500 to-pink-500 rounded-full mb-6 flex items-center justify-center">
                <span class="text-3xl text-white">ğŸ¤</span>
            </div>
            <h3 class="text-2xl font-bold text-red-700 mb-2">ÄANG NGHE...</h3>
            <p class="text-lg font-mono text-gray-800 mb-6">NÃ³i rÃµ tá»«: <strong>${word}</strong></p>
            <div class="flex justify-center space-x-4">
                <div class="w-4 h-4 bg-red-500 rounded-full animate-bounce"></div>
                <div class="w-4 h-4 bg-red-500 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                <div class="w-4 h-4 bg-red-500 rounded-full animate-bounce" style="animation-delay: 0.4s"></div>
            </div>
        </div>
    `;

    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = new SpeechRecognition();
    
    recognition.lang = 'en-US';
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;
    
    recognition.onresult = function(event) {
        const transcript = event.results[0][0].transcript.trim();
        const confidence = Math.round(event.results[0][0].confidence * 100);
        
        const score = calculateScore(word, transcript);
        
        // Update stats
        const wordData = currentAssignment.wordsData.find(w => w.word === word);
        if (wordData) {
            wordData.attempts++;
            if (score > wordData.bestScore) wordData.bestScore = score;
        }
        
        // Update progress
        updateProgress();
        
        displayResult(resultDiv, word, transcript, score, confidence);
    };
    
    recognition.onerror = function() {
        resultDiv.innerHTML = `
            <div class="p-6 bg-red-50 border-2 border-red-200 rounded-xl text-center">
                <div class="mx-auto w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mb-4">
                    <span class="text-3xl">âŒ</span>
                </div>
                <p class="text-red-600 font-bold text-lg">KhÃ´ng nháº­n Ä‘Æ°á»£c giá»ng nÃ³i</p>
                <p class="text-sm text-red-500 mt-2">HÃ£y nÃ³i to vÃ  rÃµ rÃ ng hÆ¡n</p>
                <button onclick="recordWord('${word}')" class="mt-4 bg-red-500 hover:bg-red-600 text-white px-6 py-2 rounded-lg font-semibold">
                    ğŸ”„ Thá»­ láº¡i
                </button>
            </div>
        `;
    };
    
    recognition.start();
}

function displayResult(resultDiv, correctWord, spokenWord, score, confidence) {
    const color = score >= 85 ? 'emerald' : score >= 70 ? 'yellow' : score >= 50 ? 'orange' : 'red';
    const emoji = score >= 85 ? 'ğŸ‰' : score >= 70 ? 'ğŸ‘' : score >= 50 ? 'ğŸ˜' : 'ğŸ’ª';
    
    resultDiv.innerHTML = `
        <div class="p-6 bg-gradient-to-br from-${color}-50 to-white border-2 border-${color}-200 rounded-2xl shadow-lg text-center">
            <!-- Score -->
            <div class="inline-block w-24 h-24 bg-gradient-to-br ${
                score >= 85 ? 'from-emerald-500 to-emerald-600' :
                score >= 70 ? 'from-yellow-500 to-yellow-600' :
                score >= 50 ? 'from-orange-500 to-orange-600' : 'from-red-500 to-red-600'
            } rounded-full flex items-center justify-center mb-6 shadow-xl">
                <span class="text-3xl font-bold text-white">${emoji}</span>
            </div>
            
            <h3 class="text-4xl font-bold text-gray-800 mb-4">
                <span class="text-${color}-600">${score}</span>
                <span class="text-xl">Ä‘iá»ƒm</span>
            </h3>
            
            <!-- Word Comparison -->
            <div class="grid grid-cols-2 gap-4 mb-6">
                <div class="bg-white rounded-xl p-4 border">
                    <p class="text-xs font-mono text-gray-600 mb-2">ğŸ¯ Tá»« Ä‘Ãºng:</p>
                    <p class="text-lg font-bold text-emerald-700">${correctWord}</p>
                </div>
                <div class="bg-white rounded-xl p-4 border">
                    <p class="text-xs font-mono text-gray-600 mb-2">ğŸ¤ Báº¡n nÃ³i:</p>
                    <p class="text-lg font-bold text-purple-700">${spokenWord}</p>
                </div>
            </div>
            
            <!-- Confidence -->
            <div class="bg-gray-50 p-3 rounded-xl mb-6">
                <p class="text-sm font-semibold text-gray-700">
                    ğŸ¤– Äá»™ chÃ­nh xÃ¡c AI: <span class="text-blue-600 font-bold">${confidence}%</span>
                </p>
            </div>
            
            <!-- Buttons -->
            <div class="grid grid-cols-3 gap-3">
                <button onclick="speakWord('${correctWord}', 0.6)" 
                        class="bg-gradient-to-r from-amber-500 to-orange-500 text-white py-3 rounded-xl font-semibold text-sm hover:shadow-lg transition-all">
                    ğŸŒ Nghe cháº­m
                </button>
                <button onclick="speakWord('${correctWord}', 1)" 
                        class="bg-gradient-to-r from-emerald-500 to-teal-500 text-white py-3 rounded-xl font-semibold text-sm hover:shadow-lg transition-all">
                    â–¶ï¸ Nghe chuáº©n
                </button>
                <button onclick="recordWord('${correctWord}')" 
                        class="bg-gradient-to-r from-blue-500 to-indigo-500 text-white py-3 rounded-xl font-semibold text-sm hover:shadow-lg transition-all col-span-1">
                    ğŸ¤ Thá»­ láº¡i
                </button>
            </div>
        </div>
    `;
}

// ==================== RENDER WORDS ====================
function renderWordsList() {
    let html = '';
    const wordsData = currentAssignment.wordsData || [];
    
    wordsData.forEach((data, index) => {
        const word = data.word;
        const syllables = splitIntoSyllables(word);
        
        const syllableDisplay = syllables.map(s => 
            `<span class="inline-block bg-emerald-100 text-emerald-800 px-3 py-1 rounded-full mx-1 font-mono font-bold text-sm">${s}</span>`
        ).join('');
        
        html += `
            <div class="bg-white rounded-2xl shadow-xl p-8 text-center border-2 border-gray-200 hover:border-emerald-400 hover:shadow-2xl transition-all duration-300">
                <h3 class="text-5xl font-bold mb-6 text-gray-800">${word}</h3>
                
                <div class="bg-gray-50 rounded-xl p-6 mb-8">
                    <p class="text-sm text-gray-600 mb-4 font-medium">ğŸ“ Ã‚m tiáº¿t:</p>
                    <div class="flex flex-wrap justify-center gap-2">
                        ${syllableDisplay}
                    </div>
                </div>
                
                <div class="flex flex-wrap gap-3 justify-center mb-8">
                    <button onclick="speakWord('${word}', 0.4)" 
                            class="bg-gradient-to-r from-amber-500 to-orange-500 text-white px-4 py-2 rounded-xl font-semibold hover:shadow-lg transition-all text-sm flex items-center gap-1">
                        ğŸ¢ Cháº­m
                    </button>
                    <button onclick="speakWord('${word}', 1)" 
                            class="bg-gradient-to-r from-emerald-500 to-teal-500 text-white px-4 py-2 rounded-xl font-semibold hover:shadow-lg transition-all text-sm flex items-center gap-1">
                        â–¶ï¸ Chuáº©n
                    </button>
                </div>
                
                <button onclick="recordWord('${word}')" 
                        class="w-full bg-gradient-to-r from-emerald-500 via-green-600 to-teal-600 text-white py-4 rounded-2xl font-bold text-xl shadow-xl hover:shadow-2xl hover:scale-105 transform transition-all duration-300 flex items-center justify-center gap-3">
                    <span class="text-2xl">ğŸ¤</span>
                    <span>THU Ã‚M NGAY</span>
                </button>
                
                <div id="result-${word}" class="mt-8"></div>
            </div>
        `;
    });
    
    document.getElementById('wordsList').innerHTML = html;
    updateProgress();
}

function updateProgress() {
    const wordsData = currentAssignment.wordsData || [];
    const total = wordsData.length;
    const completed = wordsData.filter(w => w.attempts > 0).length;
    const avgScore = wordsData.length > 0 ? 
        Math.round(wordsData.reduce((sum, w) => sum + w.bestScore, 0) / wordsData.length) : 0;
    
    document.getElementById('progressText').textContent = `${completed}/${total}`;
    document.getElementById('avgScoreText').textContent = avgScore;
}

// ==================== DEMO MODE ====================
window.startDemo = function() {
    currentUser = { role: 'demo', name: 'KhÃ¡ch' };
    currentAssignment = { 
        id: 'demo', 
        name: 'ğŸš€ CHáº¾ Äá»˜ THá»¬ NGHIá»†M', 
        wordsData: [
            { word: 'protein', attempts: 0, bestScore: 0 },
            { word: 'vitamin', attempts: 0, bestScore: 0 },
            { word: 'carbohydrate', attempts: 0, bestScore: 0 },
            { word: 'exercise', attempts: 0, bestScore: 0 },
            { word: 'healthy', attempts: 0, bestScore: 0 }
        ]
    };
    
    document.getElementById('assignmentTitle').textContent = currentAssignment.name;
    renderWordsList();
    showScreen('practiceScreen');
}

// ==================== INIT ====================
window.addEventListener('load', function() {
    console.log('âœ… LIME Speech App loaded successfully!');
    console.log('ğŸ¤ Web Speech API:', 'webkitSpeechRecognition' in window || 'SpeechRecognition' in window ? 'âœ… Available' : 'âŒ Not available');
    
    // Auto demo after 2 seconds
    setTimeout(() => {
        if (!currentUser) {
            startDemo();
        }
    }, 2000);
});

// Make functions global
window.showScreen = showScreen;
window.loginStudent = loginStudent;
window.loginTeacher = loginTeacher;
window.startDemo = startDemo;
window.recordWord = recordWord;
window.speakWord = speakWord;
window.selectRole = selectRole;
window.backToStudent = backToStudent;
window.startAssignment = startAssignment;
window.logout = logout;

</script>
</body>
</html>
